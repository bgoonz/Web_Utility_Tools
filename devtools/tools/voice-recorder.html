<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      var deskAdsNum = 0;
    </script>
    <script async src="../lib/tagmng4.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="../lib/tools.css" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../lib/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      href="../lib/favicon/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      type="image/png"
      href="../lib/favicon/favicon-16x16.png"
      sizes="16x16"
    />
    <link rel="manifest" href="../lib/favicon/manifest.json" />
    <link
      rel="mask-icon"
      href="../lib/favicon/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="../lib/favicon/favicon.ico" />
    <meta
      name="msapplication-config"
      content="/lib/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#ffffff" />
    <meta name="format-detection" content="telephone=no" />

    <title>Voice Recorder Online</title>
    <meta
      name="description"
      content="Voice recorder. Audio/sound/music recorder online app from microphone."
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <style>
      h1 {
        font-size: 1.6rem;
      }
      h2 {
        font-size: 1.4rem;
      }
      h4 {
        font-size: 1.2rem;
      }
      #myform {
        max-width: 600px;
        padding: 20px;
        background: #687070;
        border: 1px solid #eee;
        border-radius: 7px;
        touch-action: manipulation;
      }
      #myform .btn span {
        vertical-align: middle;
      }
      #myform #recordbtn {
        padding: 1rem;
      }
      #myform #btngroup1 {
        width: 100%;
      }
      #myform #savebtn,
      #myform #savebtn span {
        color: white;
      }
      #myform audio {
        width: 100%;
      }
      #myform #micwarn {
        display: none;
      }
      .visualizer {
        width: 100%;
        height: 60px;
        background: #ccc;
        border: 1px #aaa solid;
      }
      /*#myform .clips audio { }*/
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/bgoonz/GIT-CDN-FILES/mdn-article.css"
    />
  </head>
  <body>
    <div id="header">
      <div>
        <div id="logo" class="box">
          <p>
            <a href="../index.html">WebDevHubTools</a>
          </p>
        </div>
      </div>
    </div>
    <div id="wrapper">
      <div id="nav">
        <a href="../index.html">Home</a>&rsaquo;<a href="index.html">Tools</a
        >&rsaquo; Voice recorder
      </div>
      <div id="top-ad">
        <ins
          class="adsbygoogle adslot_1"
          data-ad-client="ca-pub-7356419691275579"
          data-ad-slot="1390814895"
        ></ins>
      </div>
      <div id="lcol">
        <div id="doc">
          <h1>Voice Recorder</h1>
          <form id="myform">
            <div class="form-group">
              <button
                type="button"
                id="recordbtn"
                title="Record"
                class="btn btn-block btn-success btn-lg"
              >
                <img
                  src="../lib/icons/material/svg/mic_white_24dp.svg"
                  loading="lazy"
                  width="24"
                  height="24"
                  alt=""
                />
                Record
              </button>
            </div>
            <div
              id="micwarn"
              class="alert alert-warning alert-dismissible fade show"
              role="alert"
            >
              Please allow microphone access by clicking the camera icon in the
              browser's address bar.
              <button
                type="button"
                class="close"
                data-dismiss="alert"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div
              id="btngroup1"
              class="btn-group"
              role="group"
              aria-label="Toolbar"
            >
              <button
                type="button"
                id="pausebtn"
                title="Pause"
                class="btn btn-secondary btn-lg w-50 mr-1"
              >
                <img
                  src="../lib/icons/material/svg/pause_white_24dp.svg"
                  loading="lazy"
                  width="24"
                  height="24"
                  alt=""
                />
                Pause
              </button>
              <button
                type="button"
                id="stopbtn"
                title="Stop"
                class="btn btn-secondary btn-lg w-50"
              >
                <img
                  src="../lib/icons/material/svg/stop_white_24dp.svg"
                  loading="lazy"
                  width="24"
                  height="24"
                  alt=""
                />
                Stop
              </button>
            </div>
            <div class="form-group mt-4">
              <canvas class="visualizer" height="60"></canvas>
            </div>
            <div class="form-group form-row sound-clips mt-4">
              <audio id="player" controls></audio>
            </div>

            <div class="form-group">
              <a
                id="savebtn"
                title="Save to downloads folder"
                class="btn btn-block btn-secondary btn-lg disabled"
                ><img
                  src="../lib/icons/material/svg/save_alt_white_24dp.svg"
                  loading="lazy"
                  width="24"
                  height="24"
                  alt=""
                />
                Save</a
              >
            </div>
          </form>
          <p>
            * The microphone access should be enabled by clicking the camera/mic
            icon in the browser's address bar.
          </p>
          <br />
          <hr />
          <h2>See also</h2>
          <ul class="seealso">
            <li><a href="mic-test.html">Microphone test</a></li>
            <li><a href="screen-recorder.html">Screen recorder</a></li>
            <li><a href="screenshot.html">Screenshot online</a></li>
            <li><a href="text-to-speech.html">Text to speech</a></li>
            <li><a href="mirror.html">Online Mirror</a></li>
            <li><a href="notepad.html">Online Notepad</a></li>
          </ul>

          <div id="ban-ad">
            <ins
              class="adsbygoogle adslot_3"
              data-ad-client="ca-pub-7356419691275579"
              data-ad-slot="9463417041"
            ></ins>
          </div>
        </div>
      </div>
      <div id="rcol">
        <ins
          class="adsbygoogle adslot_2"
          data-ad-client="ca-pub-7356419691275579"
          data-ad-slot="5385900220"
        ></ins>

        <h5>ONLINE TOOLS</h5>
        <ul>
          <li><a href="alarm-clock.html">Alarm Clock</a></li>
          <li><a href="bar-graph.html">Bar graph maker</a></li>
          <li><a href="calendar.html">Calendar</a></li>
          <li><a href="timer.html">Countdown Timer</a></li>
          <li><a href="current-time.html">Current Time</a></li>
          <li><a href="line-graph.html">Line graph maker</a></li>
          <li><a href="../calc/math/calculator.html">Online Calculator</a></li>
          <li><a href="grocery-list.html">Online grocery list</a></li>
          <li><a href="mic-test.html">Mic test</a></li>
          <li><a href="notepad.html">Online Notepad</a></li>
          <li><a href="notes.html">Online Notes</a></li>
          <li><a href="mirror.html">Online Mirror</a></li>
          <li><a href="password-generator.html">Password generator</a></li>
          <li><a href="pie-chart.html">Pie chart maker</a></li>
          <li><a href="screen-recorder.html">Screen recorder</a></li>
          <li><a href="screenshot.html">Online screenshot</a></li>
          <li><a href="speech-to-text.html">Speech to text</a></li>
          <li><a href="stopwatch.html">Stopwatch</a></li>
          <li><a href="text-to-speech.html">Text to speech</a></li>
          <li><a href="todays-date.html">Today's Date</a></li>
          <li><a href="todo-list.html">To-Do List</a></li>
          <li><a href="voice-recorder.html">Voice recorder</a></li>
          <li><a href="where-am-i.html">Find my location</a></li>
          <li><a href="webcam-test.html">Webcam test</a></li>
        </ul>
        <h5>RAPID TABLES</h5>
        <ul>
          <li>
            <a
              href="mailto:?subject=RapidTables%20website&amp;body=Please%20checkout%20this%20site:%20https://www.WebDevHubTools"
              >Recommend Site</a
            >
          </li>
          <li><a href="voice-recorder.html#feedback">Send Feedback</a></li>
        </ul>
      </div>
    </div>
    <div id="footer">
      <a href="../index.html">Home</a> | <a href="../web/index.html">Web</a> |
      <a href="../math/index.html">Math</a> |
      <a href="../electric/index.html">Electricity</a> |
      <a href="../calc/index.html">Calculators</a> |
      <a href="../convert/index.html">Converters</a> |
      <a href="index.html">Tools</a>
      <p>&copy; <a href="../index.html">WebDevHubTools</a> |</p>
    </div>
    <div id="banner"></div>

    <script src="../lib/utils/utils.js"></script>

    <script>
      !(function (e, t) {
        "object" == typeof exports && "undefined" != typeof module
          ? t()
          : "function" == typeof define && define.amd
          ? define(t)
          : t();
      })(0, function () {
        "use strict";
        function e(e) {
          var t = this.constructor;
          return this.then(
            function (n) {
              return t.resolve(e()).then(function () {
                return n;
              });
            },
            function (n) {
              return t.resolve(e()).then(function () {
                return t.reject(n);
              });
            }
          );
        }
        function t(e) {
          return new this(function (t, n) {
            function o(e, n) {
              if (n && ("object" == typeof n || "function" == typeof n)) {
                var f = n.then;
                if ("function" == typeof f)
                  return void f.call(
                    n,
                    function (t) {
                      o(e, t);
                    },
                    function (n) {
                      (r[e] = { status: "rejected", reason: n }),
                        0 == --i && t(r);
                    }
                  );
              }
              (r[e] = { status: "fulfilled", value: n }), 0 == --i && t(r);
            }
            if (!e || "undefined" == typeof e.length)
              return n(
                new TypeError(
                  typeof e +
                    " " +
                    e +
                    " is not iterable(cannot read property Symbol(Symbol.iterator))"
                )
              );
            var r = Array.prototype.slice.call(e);
            if (0 === r.length) return t([]);
            for (var i = r.length, f = 0; r.length > f; f++) o(f, r[f]);
          });
        }
        function n(e) {
          return !(!e || "undefined" == typeof e.length);
        }
        function o() {}
        function r(e) {
          if (!(this instanceof r))
            throw new TypeError("Promises must be constructed via new");
          if ("function" != typeof e) throw new TypeError("not a function");
          (this._state = 0),
            (this._handled = !1),
            (this._value = undefined),
            (this._deferreds = []),
            l(e, this);
        }
        function i(e, t) {
          for (; 3 === e._state; ) e = e._value;
          0 !== e._state
            ? ((e._handled = !0),
              r._immediateFn(function () {
                var n = 1 === e._state ? t.onFulfilled : t.onRejected;
                if (null !== n) {
                  var o;
                  try {
                    o = n(e._value);
                  } catch (r) {
                    return void u(t.promise, r);
                  }
                  f(t.promise, o);
                } else (1 === e._state ? f : u)(t.promise, e._value);
              }))
            : e._deferreds.push(t);
        }
        function f(e, t) {
          try {
            if (t === e)
              throw new TypeError("A promise cannot be resolved with itself.");
            if (t && ("object" == typeof t || "function" == typeof t)) {
              var n = t.then;
              if (t instanceof r)
                return (e._state = 3), (e._value = t), void c(e);
              if ("function" == typeof n)
                return void l(
                  (function (e, t) {
                    return function () {
                      e.apply(t, arguments);
                    };
                  })(n, t),
                  e
                );
            }
            (e._state = 1), (e._value = t), c(e);
          } catch (o) {
            u(e, o);
          }
        }
        function u(e, t) {
          (e._state = 2), (e._value = t), c(e);
        }
        function c(e) {
          2 === e._state &&
            0 === e._deferreds.length &&
            r._immediateFn(function () {
              e._handled || r._unhandledRejectionFn(e._value);
            });
          for (var t = 0, n = e._deferreds.length; n > t; t++)
            i(e, e._deferreds[t]);
          e._deferreds = null;
        }
        function l(e, t) {
          var n = !1;
          try {
            e(
              function (e) {
                n || ((n = !0), f(t, e));
              },
              function (e) {
                n || ((n = !0), u(t, e));
              }
            );
          } catch (o) {
            if (n) return;
            (n = !0), u(t, o);
          }
        }
        var a = setTimeout;
        (r.prototype["catch"] = function (e) {
          return this.then(null, e);
        }),
          (r.prototype.then = function (e, t) {
            var n = new this.constructor(o);
            return (
              i(
                this,
                new (function (e, t, n) {
                  (this.onFulfilled = "function" == typeof e ? e : null),
                    (this.onRejected = "function" == typeof t ? t : null),
                    (this.promise = n);
                })(e, t, n)
              ),
              n
            );
          }),
          (r.prototype["finally"] = e),
          (r.all = function (e) {
            return new r(function (t, o) {
              function r(e, n) {
                try {
                  if (n && ("object" == typeof n || "function" == typeof n)) {
                    var u = n.then;
                    if ("function" == typeof u)
                      return void u.call(
                        n,
                        function (t) {
                          r(e, t);
                        },
                        o
                      );
                  }
                  (i[e] = n), 0 == --f && t(i);
                } catch (c) {
                  o(c);
                }
              }
              if (!n(e))
                return o(new TypeError("Promise.all accepts an array"));
              var i = Array.prototype.slice.call(e);
              if (0 === i.length) return t([]);
              for (var f = i.length, u = 0; i.length > u; u++) r(u, i[u]);
            });
          }),
          (r.allSettled = t),
          (r.resolve = function (e) {
            return e && "object" == typeof e && e.constructor === r
              ? e
              : new r(function (t) {
                  t(e);
                });
          }),
          (r.reject = function (e) {
            return new r(function (t, n) {
              n(e);
            });
          }),
          (r.race = function (e) {
            return new r(function (t, o) {
              if (!n(e))
                return o(new TypeError("Promise.race accepts an array"));
              for (var i = 0, f = e.length; f > i; i++)
                r.resolve(e[i]).then(t, o);
            });
          }),
          (r._immediateFn =
            ("function" == typeof setImmediate &&
              function (e) {
                setImmediate(e);
              }) ||
            function (e) {
              a(e, 0);
            }),
          (r._unhandledRejectionFn = function (e) {
            void 0 !== console &&
              console &&
              console.warn("Possible Unhandled Promise Rejection:", e);
          });
        var s = (function () {
          if ("undefined" != typeof self) return self;
          if ("undefined" != typeof window) return window;
          if ("undefined" != typeof global) return global;
          throw Error("unable to locate global object");
        })();
        "function" != typeof s.Promise
          ? (s.Promise = r)
          : s.Promise.prototype["finally"]
          ? s.Promise.allSettled || (s.Promise.allSettled = t)
          : (s.Promise.prototype["finally"] = e);
      });
    </script>
    <script>
      var voiceRec;
      const recordButton = document.getElementById("recordbtn");
      const pauseButton = document.getElementById("pausebtn");
      const stopButton = document.getElementById("stopbtn");
      const saveButton = document.getElementById("savebtn");
      const audio = document.getElementById("player");
      const micwarnDiv = document.getElementById("micwarn");
      const soundClips = document.querySelector(".sound-clips");
      const canvas = document.querySelector(".visualizer");
      const canvasCtx = canvas.getContext("2d");

      window.addEventListener("DOMContentLoaded", function () {
        voiceRec = new VoiceRec();
      });

      function VoiceRec() {
        this.RecState = {
          STOP: 0,
          RECORD: 1,
          PAUSE: 2,
        };
        this.state = this.RecState.STOP;
        this.stream = null;
        this.mediaRecorder = null;
        this.recordedChunks = null;
        micwarnDiv.style.display = "none";
        recordButton.addEventListener("click", this.start.bind(this));
        pauseButton.addEventListener("click", this.pause.bind(this));
        stopButton.addEventListener("click", this.stop.bind(this));
        saveButton.addEventListener("click", this.save.bind(this));

        this.init();
      }

      VoiceRec.prototype.init = function () {
        if (MediaRecorder !== undefined) {
          var types = [
            "audio/mp3",
            "audio/aac",
            "audio/mpeg",
            "audio/ogg;codecs=opus",
            "audio/webm;codecs=opus",
            "audio/wav",
            "audio/x-wav",
            "audio/vnd.wav",
            "audio/flac",
            "audio/mp4",
            "audio/opus",
            "audio/wma",
            "audio/raw",
            "audio/oga",
            "audio/ogg",
            "audio/ogg;codecs=vorbis",
            "application/ogg",
            "video/ogg",
            "video/h264",
            "video/h265",
            "video/mp4;codecs=avc1.42E01E, mp4a.40.2",
            "video/mp4",
            "video/quicktime",
            "video/webm; codecs=vp8",
            "video/webm; codecs=vp9",
            "video/webm; codecs=opus",
            "video/webm",
          ];

          var names = document.getElementsByName("formats");
          for (var i in types) {
            console.log(
              types[i] + " " + MediaRecorder.isTypeSupported(types[i])
            );
            //if( !MediaRecorder.isTypeSupported(types[i]) )
            //   names[i].style.display="none";
          }
        }
        // initpoly()
        if (navigator.mediaDevices === undefined) {
          navigator.mediaDevices = {};
        }
        if (navigator.mediaDevices.getUserMedia === undefined) {
          navigator.mediaDevices.getUserMedia = function (constraints) {
            var getUserMedia =
              navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
            if (!getUserMedia) {
              return Promise.reject(
                new Error("getUserMedia is not implemented in this browser")
              );
            }
            return new Promise(function (resolve, reject) {
              getUserMedia.call(navigator, constraints, resolve, reject);
            });
          };
        }
      };

      VoiceRec.prototype.start = function () {
        this.checkMic();
        this.recordedChunks = [];
        audio.src = null;
        recordButton.classList.remove("btn-success");
        recordButton.classList.add("btn-danger");

        const constraints = { audio: true, video: false };
        /*
      const constraints = {
         audio: {
            echoCancellation: false,
            noiseSuppression: false,
            autoGainControl: false
         }
      };
      */
        if (navigator.mediaDevices === undefined) {
          navigator.mediaDevices = {};
        }
        /*
      if (navigator.mediaDevices.getUserMedia === undefined) {
         navigator.mediaDevices.getUserMedia = function(constraints) {
            var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
            if (!getUserMedia) {
               alert("Please open this page with recent version of Chrome browser!");
               return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
            }
            return new Promise(function(resolve, reject) {
               getUserMedia.call(navigator, constraints, resolve, reject);
            });
         }
      }
      */
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(this.onSuccess.bind(this));
      };
      VoiceRec.prototype.pause = function () {
        if (this.state == this.RecState.STOP) return;
        if (this.state == this.RecState.RECORD) {
          this.state = this.RecState.PAUSE;
          this.mediaRecorder.pause();
          pauseButton.innerHTML =
            "<img src='../lib/icons/material/svg/play_arrow_white_24dp.svg' loading='lazy' width='24' height='24' alt=''> Resume";
        } else {
          this.state = this.RecState.RECORD;
          this.mediaRecorder.resume();
          pauseButton.innerHTML =
            "<img src='../lib/icons/material/svg/pause_white_24dp.svg' loading='lazy' width='24' height='24' alt=''> Pause";
        }
      };
      VoiceRec.prototype.stop = function () {
        if (this.state == this.RecState.STOP) return;
        this.mediaRecorder.stop();
        recordButton.classList.remove("btn-danger");
        recordButton.classList.add("btn-success");
        saveButton.classList.remove("disabled");
        pauseButton.innerHTML =
          "<img src='../lib/icons/material/svg/pause_white_24dp.svg' loading='lazy' width='24' height='24' alt=''> Pause";
      };

      VoiceRec.prototype.onSuccess = function (stream) {
        visualize(stream);
        this.state = this.RecState.RECORD;
        this.stream = stream;
        /*
      if ("srcObject" in audio) {
         audio.srcObject = stream;
      } else {
         // Avoid using this in new browsers, as it is going away.
         audio.src = window.URL.createObjectURL(stream);
      }
      return;
*/

        const options = { mimeType: "audio/webm;codecs=opus" };
        //const options = {mimeType: 'audio/ogg'};
        //const recordedChunks = [];
        this.recordedChunks = [];
        this.mediaRecorder = new MediaRecorder(stream, options);
        //this.init();
        this.mediaRecorder.addEventListener(
          "dataavailable",
          this.ondataavailable.bind(this)
        );
        this.mediaRecorder.addEventListener("stop", this.onstop.bind(this));
        this.mediaRecorder.start();
      };
      VoiceRec.prototype.ondataavailable = function (e) {
        if (e.data.size > 0) {
          this.recordedChunks.push(e.data);
        }
      };
      VoiceRec.prototype.onstop = function () {
        this.state = this.RecState.STOP;
        this.stream.getTracks().forEach((track) => track.stop());
        this.stream = null;
        audio.controls = true;
        //const blob = new Blob(this.recordedChunks, {'type' : 'audio/ogg; codecs=opus'});
        const blob = new Blob(this.recordedChunks, {
          type: "audio/webm; codecs=opus",
        });
        //this.recordedChunks = [];
        const audioURL = window.URL.createObjectURL(blob);
        audio.src = audioURL;
      };
      VoiceRec.prototype.save = function () {
        if (this.recordedChunks.length == 0) return;
        const clipName = prompt("Enter name for your sound clip:", "soundclip");
        saveButton.href = URL.createObjectURL(new Blob(this.recordedChunks));
        saveButton.download = clipName + ".webm"; //!!!!
        //saveButton.click();
        this.recordedChunks = [];
      };

      VoiceRec.prototype.checkMic = function () {
        var browser = get_browser();
        if (browser != "Chrome") return;
        try {
          navigator.permissions
            .query({ name: "microphone" })
            .then(function (result) {
              if (result.state == "granted") {
              } else if (result.state == "prompt") {
              } else if (result.state == "denied") {
                micwarnDiv.style.display = "block";
              }
              result.onchange = function (e) {
                if (e.srcElement.state == "denied")
                  micwarnDiv.style.display = "block";
                else micwarnDiv.style.display = "none";
              };
            });
        } catch (error) {
          console.log(error);
        }
      };

      function visualize(stream) {
        var audioCtx = 0;
        if (!audioCtx) {
          audioCtx = new AudioContext();
        }
        const source = audioCtx.createMediaStreamSource(stream);
        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        source.connect(analyser);
        //analyser.connect(audioCtx.destination);
        draw();

        function draw() {
          const WIDTH = canvas.width;
          const HEIGHT = canvas.height;
          requestAnimationFrame(draw);
          analyser.getByteTimeDomainData(dataArray);
          canvasCtx.fillStyle = "rgb(200, 200, 200)";
          canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
          canvasCtx.lineWidth = 2;
          canvasCtx.strokeStyle = "rgb(0, 0, 0)";
          canvasCtx.beginPath();
          let sliceWidth = (WIDTH * 1.0) / bufferLength;
          let x = 0;
          for (let i = 0; i < bufferLength; i++) {
            let v = dataArray[i] / 128.0;
            let y = (v * HEIGHT) / 2;
            if (i === 0) {
              canvasCtx.moveTo(x, y);
            } else {
              canvasCtx.lineTo(x, y);
            }
            x += sliceWidth;
          }

          canvasCtx.lineTo(canvas.width, canvas.height / 2);
          canvasCtx.stroke();
        }
      }
    </script>
  </body>
</html>
